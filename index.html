<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulación sin API - Rutas por Coordenadas</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Anime.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .vehicle {
      background-color: red;
      border-radius: 50%;
      width: 14px;
      height: 14px;
      transform: translate(-7px, -7px);
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Inicializamos el mapa centrado en Monterrey
    const map = L.map('map').setView([25.6866, -100.3161], 15);

    // Capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // =======================
    // VARIABLES DE RUTAS
    // =======================

    const ruta1 = [
      [25.6866, -100.3161],
      [25.6868, -100.3140],
      [25.6875, -100.3130],
      [25.6880, -100.3105],
      [25.6890, -100.3090]
    ];

    const ruta2 = [
      [25.6866, -100.3161],
      [25.6858, -100.3175],
      [25.6845, -100.3160],
      [25.6835, -100.3135],
      [25.6828, -100.3110]
    ];

    const ruta3 = [
      [25.6866, -100.3161],
      [25.6872, -100.3180],
      [25.6885, -100.3195],
      [25.6895, -100.3180],
      [25.6900, -100.3160]
    ];

    const rutas = [ruta1, ruta2, ruta3];
    const colores = ['blue', 'green', 'orange'];

    const marcadores = [];

    // =======================
    // DIBUJAR RUTAS Y VEHÍCULOS
    // =======================

    rutas.forEach((ruta, i) => {
      // Dibujar la línea
      L.polyline(ruta, {
        color: colores[i],
        weight: 4
      }).addTo(map);

      // Crear marcador tipo vehículo
      const marcador = L.marker(ruta[0], {
        icon: L.divIcon({ className: 'vehicle' })
      }).addTo(map);

      marcadores.push({ marcador, ruta });
    });

    // =======================
    // ANIMAR VEHÍCULOS CON ANIME.JS
    // =======================

    function animarRuta(marcador, coordenadas, velocidadMs) {
      let i = 0;

      function moverAlSiguienteTramo() {
        if (i >= coordenadas.length - 1) {
          i = 0; // reinicia la ruta
        }

        const inicio = { lat: coordenadas[i][0], lng: coordenadas[i][1] };
        const fin = { lat: coordenadas[i + 1][0], lng: coordenadas[i + 1][1] };

        anime({
          targets: inicio,
          lat: fin.lat,
          lng: fin.lng,
          duration: velocidadMs * 100,
          easing: 'linear',
          update: () => {
            marcador.setLatLng([inicio.lat, inicio.lng]);
          },
          complete: () => {
            i++;
            moverAlSiguienteTramo();
          }
        });
      }

      moverAlSiguienteTramo();
    }

    // Lanzar las animaciones
    animarRuta(marcadores[0].marcador, marcadores[0].ruta, 50);  // rápido
    animarRuta(marcadores[1].marcador, marcadores[1].ruta, 100); // medio
    animarRuta(marcadores[2].marcador, marcadores[2].ruta, 150); // lento
  </script>
</body>
</html>
